



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Installing Mattermost on Ubuntu 18.04 LTS &mdash; Mattermost 5.33 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  

  
    <link rel="canonical" href="https://docs.mattermost.com/install/install-ubuntu-1804.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Installing Mattermost Omnibus" href="mattermost-omnibus.html" />
    <link rel="prev" title="Installing Mattermost on Ubuntu 20.04 LTS" href="install-ubuntu-2004.html" />
  
  	<!-- Google Tag Manager -->
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-K874RWM');</script>
	<!-- End Google Tag Manager -->
	
</head>

<body class="wy-body-for-nav">

	<!-- Google Tag Manager (noscript) -->
	<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K874RWM"
	height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<!-- End Google Tag Manager (noscript) -->

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Mattermost
          

          
          </a>

          
            
            
              <div class="version">
                5.33
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/cloud-admin-guide.html">Cloud Administrator's Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../guides/administrator.html">Self-Managed Administrator's Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../overview/architecture.html">Architecture Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deployment/deployment.html">Deployment Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#getting-started">Getting Started</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../guides/administrator.html#installing-mattermost">Installing Mattermost</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="requirements.html">Software and Hardware Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-ubuntu-2004.html">Installing on Ubuntu 20.04 LTS</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Installing on Ubuntu 18.04 LTS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#installing-ubuntu-server-18-04-lts">Installing Ubuntu Server 18.04 LTS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-mysql-database-server">Installing MySQL Database Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-postgresql-database-server">Installing PostgreSQL Database Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-mattermost-server">Installing Mattermost Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-mattermost-server">Configuring Mattermost Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-tls-on-mattermost-server">Configuring TLS on Mattermost Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-nginx-server">Installing NGINX Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-nginx-as-a-proxy-for-mattermost-server">Configuring NGINX as a proxy for Mattermost Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-nginx-with-ssl-and-http-2">Configuring NGINX with SSL and HTTP/2</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mattermost-omnibus.html">Installing Mattermost Omnibus</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-kubernetes.html">Installing on Kubernetes</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-debian.html">Installing on Debian Buster</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-rhel-7.html">Installing on RHEL 7</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-rhel-8.html">Installing on RHEL 8</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-centos-oracle-scientific.html">Installing on CentOS, Oracle Linux, and Scientific Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="sockets-db.html">Instructions On Setting Up a Socket-based Mattermost Database</a></li>
<li class="toctree-l3"><a class="reference internal" href="ee-install.html">Enterprise Install and Upgrade</a></li>
<li class="toctree-l3"><a class="reference internal" href="transport-encryption/config.html">Configuring Transport Encryption</a></li>
<li class="toctree-l3"><a class="reference internal" href="deploy-bitnami.html">Deploy Mattermost on Bitnami</a></li>
<li class="toctree-l3"><a class="reference internal" href="docker-local-machine.html">Local Machine Setup using Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="docker-ebs.html">AWS Elastic Beanstalk Docker Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-mmte-helm-gitlab-helm.html">Installing Mattermost Team Edition in GitLab Helm Chart</a></li>
<li class="toctree-l3"><a class="reference internal" href="desktop.html">Desktop Application Install Guides</a></li>
<li class="toctree-l3"><a class="reference internal" href="desktop-managed-resources.html">Desktop Managed Resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="desktop-msi-gpo.html">Desktop MSI Installer and Group Policy Installation Guides (Beta)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#deployment">Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#configure-mattermost">Configure Mattermost</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#incident-collaboration">Incident Collaboration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#mobile-apps">Mobile Apps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#onboard-users">Onboard Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#administration">Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#upgrade-mattermost">Upgrade Mattermost</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#mattermost-integrations">Mattermost Integrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#mattermost-compliance">Mattermost Compliance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#scaling-mattermost">Scaling Mattermost</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#community-managed-documentation">Community-Managed Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../guides/user.html">User's Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/integration.html">Integration Guide</a></li>
<li class="toctree-l1"><a class="reference external" href="https://developers.mattermost.com/">Developer's Guide</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Mattermost</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          


  


<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
      <li><a href="../guides/administrator.html">Self-Managed Administrator’s Guide</a> &raquo;</li>
    
    <li>Installing Mattermost on Ubuntu 18.04 LTS</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/mattermost/docs/blob/master/source/install/install-ubuntu-1804.rst" class="fa fa-github"> Edit</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <article class="document" itemscope="itemscope" itemtype="https://schema.org/Article">
           <div itemprop="articleBody" role="main">
            
  <div class="section" id="installing-mattermost-on-ubuntu-18-04-lts">
<span id="install-ubuntu-1804"></span><h1>Installing Mattermost on Ubuntu 18.04 LTS<a class="headerlink" href="#installing-mattermost-on-ubuntu-18-04-lts" title="Permalink to this headline">¶</a></h1>
<p>Install a production-ready Mattermost system on 1 to 3 machines.</p>
<p>A complete Mattermost installation consists of three major components: a proxy server, a database server, and the Mattermost server. You can install all components on one machine, or you can install each component on its own machine. If you have only two machines, then install the proxy and the Mattermost server on one machine, and install the database on the other machine.</p>
<p>For the database, you can install either MySQL or PostgreSQL. The proxy is NGINX.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have any problems installing Mattermost, see the <a class="reference external" href="https://docs.mattermost.com/install/troubleshooting.html">troubleshooting guide</a>, or <a class="reference external" href="https://mattermost.com/pl/default-ask-mattermost-community/">join the Mattermost user community for troubleshooting help</a>.</p>
<p>For help with inviting users to your system, see <a class="reference external" href="https://docs.mattermost.com/help/getting-started/managing-members.html#inviting-team-members">inviting team members</a> and other <a class="reference external" href="https://docs.mattermost.com/guides/user.html#getting-started">getting started information</a>.</p>
<p>To submit an improvement or correction to this page, click <strong>Edit</strong> in the top-right corner of the page.</p>
</div>
<div class="contents local topic" id="install-and-configure-the-components-in-the-following-order-note-that-you-need-only-one-database-either-mysql-or-postgresql">
<p class="topic-title">Install and configure the components in the following order. Note that you need only one database, either MySQL or PostgreSQL.</p>
<ul class="simple">
<li><p><a class="reference internal" href="#installing-ubuntu-server-18-04-lts" id="id3">Installing Ubuntu Server 18.04 LTS</a></p></li>
<li><p><a class="reference internal" href="#installing-mysql-database-server" id="id4">Installing MySQL Database Server</a></p></li>
<li><p><a class="reference internal" href="#installing-postgresql-database-server" id="id5">Installing PostgreSQL Database Server</a></p></li>
<li><p><a class="reference internal" href="#installing-mattermost-server" id="id6">Installing Mattermost Server</a></p></li>
<li><p><a class="reference internal" href="#configuring-mattermost-server" id="id7">Configuring Mattermost Server</a></p></li>
<li><p><a class="reference internal" href="#configuring-tls-on-mattermost-server" id="id8">Configuring TLS on Mattermost Server</a></p></li>
<li><p><a class="reference internal" href="#installing-nginx-server" id="id9">Installing NGINX Server</a></p></li>
<li><p><a class="reference internal" href="#configuring-nginx-as-a-proxy-for-mattermost-server" id="id10">Configuring NGINX as a proxy for Mattermost Server</a></p>
<ul>
<li><p><a class="reference internal" href="#nginx-configuration-faq" id="id11">NGINX Configuration FAQ</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#configuring-nginx-with-ssl-and-http-2" id="id12">Configuring NGINX with SSL and HTTP/2</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id13">NGINX Configuration FAQ</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="installing-ubuntu-server-18-04-lts">
<span id="install-ubuntu-1804-server"></span><h2><a class="toc-backref" href="#install-and-configure-the-components-in-the-following-order-note-that-you-need-only-one-database-either-mysql-or-postgresql">Installing Ubuntu Server 18.04 LTS</a><a class="headerlink" href="#installing-ubuntu-server-18-04-lts" title="Permalink to this headline">¶</a></h2>
<p>Install the 64-bit version of Ubuntu Server on each machine that hosts one or more of the components.</p>
<p><strong>To install Ubuntu Server 18.04:</strong></p>
<ol class="arabic simple">
<li><p>To install Ubuntu Server 18.04, see the <a class="reference external" href="https://help.ubuntu.com/18.04/installation-guide/amd64/index.html">Ubuntu Installation Guide.</a></p></li>
<li><p>After the system is installed, make sure that it’s up to date with the most recent security patches. Open a terminal window and issue the following commands:</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">update</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">upgrade</span></code></p>
</div></blockquote>
<p>Now that the system is up to date, you can start installing the components that make up a Mattermost system.</p>
</div>
<div class="section" id="installing-mysql-database-server">
<span id="install-ubuntu-1804-mysql"></span><h2><a class="toc-backref" href="#install-and-configure-the-components-in-the-following-order-note-that-you-need-only-one-database-either-mysql-or-postgresql">Installing MySQL Database Server</a><a class="headerlink" href="#installing-mysql-database-server" title="Permalink to this headline">¶</a></h2>
<p>Install and set up the database for use by the Mattermost server. You can install either MySQL or PostgreSQL.</p>
<p><strong>To install MySQL on Ubuntu Server 18.04:</strong></p>
<ol class="arabic simple">
<li><p>Log into the server that will host the database, and open a terminal window.</p></li>
<li><p>Install MySQL.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">install</span> <span class="pre">mysql-server</span></code></p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Run <code class="docutils literal notranslate"><span class="pre">mysql_secure_installation</span></code> and follow the instructions.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">mysql_secure_installation</span></code></p>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>Log in to MySQL as root.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">mysql</span></code></p>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>Create the Mattermost user ‘mmuser’.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">mysql&gt;</span> <span class="pre">create</span> <span class="pre">user</span> <span class="pre">'mmuser'&#64;'%'</span> <span class="pre">identified</span> <span class="pre">by</span> <span class="pre">'mmuser-password';</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p>Use a password that is more secure than ‘mmuser-password’.</p></li>
<li><p>The ‘%’ means that mmuser can connect from any machine on the network. However, it’s more secure to use the IP address of the machine that hosts Mattermost. For example, if you install Mattermost on the machine with IP address 10.10.10.2, then use the following command: <code class="docutils literal notranslate"><span class="pre">mysql&gt;</span> <span class="pre">create</span> <span class="pre">user</span> <span class="pre">'mmuser'&#64;'10.10.10.2'</span> <span class="pre">identified</span> <span class="pre">by</span> <span class="pre">'mmuser-password';</span></code></p></li>
</ol>
</div>
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p>Create the Mattermost database.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">mysql&gt;</span> <span class="pre">create</span> <span class="pre">database</span> <span class="pre">mattermost;</span></code></p>
</div></blockquote>
<ol class="arabic simple" start="7">
<li><p>Grant access privileges to the user ‘mmuser’.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">mysql&gt;</span> <span class="pre">grant</span> <span class="pre">all</span> <span class="pre">privileges</span> <span class="pre">on</span> <span class="pre">mattermost.*</span> <span class="pre">to</span> <span class="pre">'mmuser'&#64;'%';</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This query grants the MySQL user we just created all privileges on the database for convenience. If you need more security you can use this query to grant the user only the privileges necessary to run Mattermost.</p>
<p><code class="docutils literal notranslate"><span class="pre">mysql&gt;</span> <span class="pre">GRANT</span> <span class="pre">ALTER,</span> <span class="pre">CREATE,</span> <span class="pre">DELETE,</span> <span class="pre">DROP,</span> <span class="pre">INDEX,</span> <span class="pre">INSERT,</span> <span class="pre">SELECT,</span> <span class="pre">UPDATE</span> <span class="pre">ON</span> <span class="pre">mattermost.*</span> <span class="pre">TO</span> <span class="pre">'mmuser'&#64;'%';</span></code></p>
</div>
</div></blockquote>
<ol class="arabic" start="8">
<li><p>Log out of MySQL.</p>
<p><code class="docutils literal notranslate"><span class="pre">mysql&gt;</span> <span class="pre">exit</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have installed MySQL on its own server, you need to edit the <code class="docutils literal notranslate"><span class="pre">/etc/mysql/mysql.conf.d/mysqld.cnf</span></code> file and comment out the <code class="docutils literal notranslate"><span class="pre">bind-address</span> <span class="pre">=</span> <span class="pre">127.0.0.1</span></code> using the <code class="docutils literal notranslate"><span class="pre">#</span></code> symbol, then restart your sql server.</p>
</div>
</li>
</ol>
<p>With the database installed and the initial setup complete, you can now install the Mattermost server.</p>
</div>
<div class="section" id="installing-postgresql-database-server">
<span id="install-ubuntu-1804-postgresql"></span><h2><a class="toc-backref" href="#install-and-configure-the-components-in-the-following-order-note-that-you-need-only-one-database-either-mysql-or-postgresql">Installing PostgreSQL Database Server</a><a class="headerlink" href="#installing-postgresql-database-server" title="Permalink to this headline">¶</a></h2>
<p>Install and set up the database for use by the Mattermost server. You can install either PostgreSQL or MySQL.</p>
<p>Assume that the IP address of this server is 10.10.10.1.</p>
<p><strong>To install PostgreSQL on Ubuntu Server 18.04:</strong></p>
<ol class="arabic simple">
<li><p>Log in to the server that will host the database and issue the following command:</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">install</span> <span class="pre">postgresql</span> <span class="pre">postgresql-contrib</span></code></p>
<p>When the installation is complete, the PostgreSQL server is running, and a Linux user account called <em>postgres</em> has been created.</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Log in to the <em>postgres</em> account.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">--login</span> <span class="pre">--user</span> <span class="pre">postgres</span></code></p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Start the PostgreSQL interactive terminal.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">psql</span></code></p>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>Create the Mattermost database.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">postgres=#</span> <span class="pre">CREATE</span> <span class="pre">DATABASE</span> <span class="pre">mattermost;</span></code></p>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>Create the Mattermost user <em>mmuser</em>.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">postgres=#</span> <span class="pre">CREATE</span> <span class="pre">USER</span> <span class="pre">mmuser</span> <span class="pre">WITH</span> <span class="pre">PASSWORD</span> <span class="pre">'mmuser-password';</span></code></p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Use a password that’s more secure than <em>mmuser-password</em>.</p>
</div>
<ol class="arabic simple" start="6">
<li><p>Grant the user access to the Mattermost database.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">postgres=#</span> <span class="pre">GRANT</span> <span class="pre">ALL</span> <span class="pre">PRIVILEGES</span> <span class="pre">ON</span> <span class="pre">DATABASE</span> <span class="pre">mattermost</span> <span class="pre">to</span> <span class="pre">mmuser;</span></code></p>
</div></blockquote>
<ol class="arabic simple" start="7">
<li><p>Exit the PostgreSQL interactive terminal.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">postgres=#</span> <span class="pre">\q</span></code></p>
</div></blockquote>
<ol class="arabic simple" start="8">
<li><p>Log out of the <em>postgres</em> account.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">exit</span></code></p>
</div></blockquote>
<ol class="arabic simple" start="9">
<li><p>(Optional) If you use a different server for your database and the Mattermost app server, you may allow PostgreSQL to listen on all assigned IP addresses. To do so, open <code class="docutils literal notranslate"><span class="pre">/etc/postgresql/{version}/main/postgresql.conf</span></code> in a text editor as <em>root</em> user. Replace <code class="docutils literal notranslate"><span class="pre">{version}</span></code> with the version of PostgreSQL that’s currently running. As a best practice, ensure that only the Mattermost server is able to connect to the PostgreSQL port using a firewall.</p></li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Find the following line:</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">#listen_addresses</span> <span class="pre">=</span> <span class="pre">'localhost'</span></code></p>
</div></blockquote>
<ol class="loweralpha simple" start="2">
<li><p>Uncomment the line and change <code class="docutils literal notranslate"><span class="pre">localhost</span></code> to <code class="docutils literal notranslate"><span class="pre">*</span></code>:</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">listen_addresses</span> <span class="pre">=</span> <span class="pre">'*'</span></code></p>
</div></blockquote>
<ol class="loweralpha simple" start="3">
<li><p>Restart PostgreSQL for the change to take effect:</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">restart</span> <span class="pre">postgresql</span></code></p>
</div></blockquote>
</div></blockquote>
<ol class="arabic simple" start="10">
<li><p>Modify the file <code class="docutils literal notranslate"><span class="pre">pg_hba.conf</span></code> to allow the Mattermost server to communicate with the database.</p></li>
</ol>
<blockquote>
<div><p><strong>If the Mattermost server and the database are on the same machine:</strong></p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Open <code class="docutils literal notranslate"><span class="pre">/etc/postgresql/{version}/main/pg_hba.conf</span></code> in a text editor as <em>root</em> user.</p></li>
<li><p>Find the following lines:</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">local</span>&#160;&#160; <span class="pre">all</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">all</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">peer</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">host</span>&#160;&#160;&#160; <span class="pre">all</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">all</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">::1/128</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">ident</span></code></p>
</div></blockquote>
<ol class="loweralpha simple" start="3">
<li><p>Change <code class="docutils literal notranslate"><span class="pre">peer</span></code> and <code class="docutils literal notranslate"><span class="pre">ident</span></code> to <code class="docutils literal notranslate"><span class="pre">trust</span></code>:</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">local</span>&#160;&#160; <span class="pre">all</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">all</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">trust</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">host</span>&#160;&#160;&#160; <span class="pre">all</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">all</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">::1/128</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">trust</span></code></p>
</div></blockquote>
</div></blockquote>
<p><strong>If the Mattermost server and the database are on different machines:</strong></p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Open <code class="docutils literal notranslate"><span class="pre">/etc/postgresql/{version}/main/pg_hba.conf</span></code> in a text editor as <em>root</em> user.</p></li>
<li><p>Add the following line to the end of the file, where <code class="docutils literal notranslate"><span class="pre">{mattermost-server-IP}</span></code> is the IP address of the machine that contains the Mattermost server.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">host</span> <span class="pre">all</span> <span class="pre">all</span> <span class="pre">{mattermost-server-IP}/32</span> <span class="pre">md5</span></code></p>
</div></blockquote>
</div></blockquote>
</div></blockquote>
<ol class="arabic simple" start="11">
<li><p>Reload PostgreSQL:</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">reload</span> <span class="pre">postgresql</span></code></p>
</div></blockquote>
<ol class="arabic simple" start="12">
<li><p>Verify that you can connect with the user <em>mmuser</em>.</p></li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>If the Mattermost server and the database are on the same machine, use the following command:</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">psql</span> <span class="pre">--dbname=mattermost</span> <span class="pre">--username=mmuser</span> <span class="pre">--password</span></code></p>
</div></blockquote>
<ol class="loweralpha simple" start="2">
<li><p>If the Mattermost server is on a different machine, log into that machine and use the following command:</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">psql</span> <span class="pre">--host={postgres-server-IP}</span> <span class="pre">--dbname=mattermost</span> <span class="pre">--username=mmuser</span> <span class="pre">--password</span></code></p>
</div></blockquote>
</div></blockquote>
<p>You might have to install the PostgreSQL client software to use the command.</p>
<p>The PostgreSQL interactive terminal starts. To exit the PostgreSQL interactive terminal, type <code class="docutils literal notranslate"><span class="pre">\q</span></code> and press ENTER.</p>
<p>With the database installed and the initial setup complete, you can now install the Mattermost server.</p>
</div>
<div class="section" id="installing-mattermost-server">
<span id="install-ubuntu-1604-mattermost"></span><h2><a class="toc-backref" href="#install-and-configure-the-components-in-the-following-order-note-that-you-need-only-one-database-either-mysql-or-postgresql">Installing Mattermost Server</a><a class="headerlink" href="#installing-mattermost-server" title="Permalink to this headline">¶</a></h2>
<p>Install Mattermost Server on a 64-bit machine.</p>
<p>Assume that the IP address of this server is 10.10.10.2.</p>
<p><strong>To install Mattermost Server on Ubuntu</strong></p>
<ol class="arabic simple">
<li><p>Log in to the server that will host Mattermost Server and open a terminal window.</p></li>
<li><p>Download <a class="reference external" href="https://mattermost.com/download/">the latest version of the Mattermost Server</a>. In the following command, replace <code class="docutils literal notranslate"><span class="pre">X.X.X</span></code> with the version that you want to download:</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">wget</span> <span class="pre">https://releases.mattermost.com/X.X.X/mattermost-X.X.X-linux-amd64.tar.gz</span></code></p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Extract the Mattermost Server files.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">tar</span> <span class="pre">-xvzf</span> <span class="pre">mattermost*.gz</span></code></p>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>Move the extracted file to the <code class="docutils literal notranslate"><span class="pre">/opt</span></code> directory.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">mv</span> <span class="pre">mattermost</span> <span class="pre">/opt</span></code></p>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>Create the storage directory for files.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">mkdir</span> <span class="pre">/opt/mattermost/data</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The storage directory will contain all the files and images that your users post to Mattermost, so you need to make sure that the drive is large enough to hold the anticipated number of uploaded files and images.</p>
</div>
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p>Set up a system user and group called <code class="docutils literal notranslate"><span class="pre">mattermost</span></code> that will run this service, and set the ownership and permissions.</p></li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Create the Mattermost user and group:</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">useradd</span> <span class="pre">--system</span> <span class="pre">--user-group</span> <span class="pre">mattermost</span></code></p>
</div></blockquote>
<ol class="loweralpha simple" start="2">
<li><p>Set the user and group <em>mattermost</em> as the owner of the Mattermost files:</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chown</span> <span class="pre">-R</span> <span class="pre">mattermost:mattermost</span> <span class="pre">/opt/mattermost</span></code></p>
</div></blockquote>
<ol class="loweralpha simple" start="3">
<li><p>Give write permissions to the <em>mattermost</em> group:</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chmod</span> <span class="pre">-R</span> <span class="pre">g+w</span> <span class="pre">/opt/mattermost</span></code></p>
</div></blockquote>
</div></blockquote>
<ol class="arabic simple" start="7">
<li><p>Set up the database driver in the file <code class="docutils literal notranslate"><span class="pre">/opt/mattermost/config/config.json</span></code>. Open the file in a text editor and make the following changes:</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>If you are using PostgreSQL:</p></li>
</ul>
<blockquote>
<div><ol class="arabic simple">
<li><p>Set <code class="docutils literal notranslate"><span class="pre">&quot;DriverName&quot;</span></code> to <code class="docutils literal notranslate"><span class="pre">&quot;postgres&quot;</span></code></p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">&quot;DataSource&quot;</span></code> to the following value, replacing <code class="docutils literal notranslate"><span class="pre">&lt;mmuser-password&gt;</span></code>  and <code class="docutils literal notranslate"><span class="pre">&lt;host-name-or-IP&gt;</span></code> with the appropriate values:</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">&quot;postgres://mmuser:&lt;mmuser-password&gt;&#64;&lt;host-name-or-IP&gt;:5432/mattermost?sslmode=disable&amp;connect_timeout=10&quot;</span></code>.</p>
</div></blockquote>
</div></blockquote>
<ul class="simple">
<li><p>If you are using MySQL:</p></li>
</ul>
<blockquote>
<div><ol class="arabic simple">
<li><p>Set <code class="docutils literal notranslate"><span class="pre">&quot;DriverName&quot;</span></code> to <code class="docutils literal notranslate"><span class="pre">&quot;mysql&quot;</span></code></p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">&quot;DataSource&quot;</span></code> to the following value, replacing <code class="docutils literal notranslate"><span class="pre">&lt;mmuser-password&gt;</span></code>  and <code class="docutils literal notranslate"><span class="pre">&lt;host-name-or-IP&gt;</span></code> with the appropriate values. Also make sure that the database name is <code class="docutils literal notranslate"><span class="pre">mattermost</span></code> instead of <code class="docutils literal notranslate"><span class="pre">mattermost_test</span></code>:</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">&quot;mmuser:&lt;mmuser-password&gt;&#64;tcp(&lt;host-name-or-IP&gt;:3306)/mattermost?charset=utf8mb4,utf8&amp;readTimeout=30s&amp;writeTimeout=30s&quot;</span></code></p>
</div></blockquote>
</div></blockquote>
</div></blockquote>
<ol class="arabic" start="8">
<li><p>Also set <code class="docutils literal notranslate"><span class="pre">&quot;SiteURL&quot;</span></code> to the full base URL of the site (e.g. <code class="docutils literal notranslate"><span class="pre">&quot;https://mattermost.example.com&quot;</span></code>).</p></li>
<li><p>Test the Mattermost server to make sure everything works.</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Change to the <code class="docutils literal notranslate"><span class="pre">mattermost</span></code> directory:</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/opt/mattermost</span></code></p>
</div></blockquote>
<ol class="loweralpha simple" start="2">
<li><p>Start the Mattermost server as the user mattermost:</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">-u</span> <span class="pre">mattermost</span> <span class="pre">./bin/mattermost</span></code></p>
</div></blockquote>
</div></blockquote>
</li>
</ol>
<blockquote>
<div><p>When the server starts, it shows some log information and the text <code class="docutils literal notranslate"><span class="pre">Server</span> <span class="pre">is</span> <span class="pre">listening</span> <span class="pre">on</span> <span class="pre">:8065</span></code>. You can stop the server by pressing CTRL+C in the terminal window.</p>
</div></blockquote>
<ol class="arabic simple" start="10">
<li><p>Setup Mattermost to use <em>systemd</em> for starting and stopping.</p></li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Create a <em>systemd</em> unit file:</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">touch</span> <span class="pre">/lib/systemd/system/mattermost.service</span></code></p>
</div></blockquote>
<ol class="loweralpha simple" start="2">
<li><p>Open the unit file as root in a text editor, and copy the following lines into the file:</p></li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[Unit]
Description=Mattermost
After=network.target
After=postgresql.service
BindsTo=postgresql.service

[Service]
Type=notify
ExecStart=/opt/mattermost/bin/mattermost
TimeoutStartSec=3600
Restart=always
RestartSec=10
WorkingDirectory=/opt/mattermost
User=mattermost
Group=mattermost
LimitNOFILE=49152

[Install]
WantedBy=postgresql.service
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are using MySQL, replace <code class="docutils literal notranslate"><span class="pre">postgresql.service</span></code> with <code class="docutils literal notranslate"><span class="pre">mysql.service</span></code> in 2 places in the <code class="docutils literal notranslate"><span class="pre">[Unit]</span></code> section and 1 place in the <code class="docutils literal notranslate"><span class="pre">[Install]</span></code> section.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have installed MySQL or PostgreSQL on a dedicated server, then you need to</p>
<blockquote>
<div><ul class="simple">
<li><p>remove <code class="docutils literal notranslate"><span class="pre">After=postgresql.service</span></code> and <code class="docutils literal notranslate"><span class="pre">BindsTo=postgresql.service</span></code> or <code class="docutils literal notranslate"><span class="pre">After=mysql.service</span></code> and <code class="docutils literal notranslate"><span class="pre">BindsTo=mysql.service</span></code> lines in the <code class="docutils literal notranslate"><span class="pre">[Unit]</span></code> section, and</p></li>
<li><p>replace the <code class="docutils literal notranslate"><span class="pre">WantedBy=postgresql.service</span></code> or <code class="docutils literal notranslate"><span class="pre">WantedBy=mysql.service</span></code> line in the <code class="docutils literal notranslate"><span class="pre">[Install]</span></code> section with <code class="docutils literal notranslate"><span class="pre">WantedBy=multi-user.target</span></code></p></li>
</ul>
</div></blockquote>
<p>or the Mattermost service will not start.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Setting <code class="docutils literal notranslate"><span class="pre">WantedBy</span></code> to your local database service ensures that whenever the database service is started, the Mattermost server starts too. This prevents the Mattermost server from stopping to work after an automatic update of the database.</p>
</div>
<ol class="loweralpha simple" start="3">
<li><p>Make systemd load the new unit.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">daemon-reload</span></code></p>
</div></blockquote>
<ol class="loweralpha simple" start="4">
<li><p>Check to make sure that the unit was loaded.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">status</span> <span class="pre">mattermost.service</span></code></p>
<p>You should see an output similar to the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>● mattermost.service - Mattermost
  Loaded: loaded (/lib/systemd/system/mattermost.service; disabled; vendor preset: enabled)
  Active: inactive (dead)
</pre></div>
</div>
</div></blockquote>
<ol class="loweralpha simple" start="5">
<li><p>Start the service.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">mattermost.service</span></code></p>
</div></blockquote>
<ol class="loweralpha simple" start="6">
<li><p>Verify that Mattermost is running.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">http://localhost:8065</span></code></p>
<p>You should see the HTML that’s returned by the Mattermost server.</p>
</div></blockquote>
<ol class="loweralpha simple" start="7">
<li><p>Set Mattermost to start on machine start up.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">enable</span> <span class="pre">mattermost.service</span></code></p>
</div></blockquote>
</div></blockquote>
<p>Now that the Mattermost server is up and running, you can do some initial configuration and setup.</p>
</div>
<div class="section" id="configuring-mattermost-server">
<h2><a class="toc-backref" href="#install-and-configure-the-components-in-the-following-order-note-that-you-need-only-one-database-either-mysql-or-postgresql">Configuring Mattermost Server</a><a class="headerlink" href="#configuring-mattermost-server" title="Permalink to this headline">¶</a></h2>
<p>Create the System Admin user and set up Mattermost for general use.</p>
<ol class="arabic simple">
<li><p>Open a browser and navigate to your Mattermost instance. For example, if the IP address of the Mattermost server is <code class="docutils literal notranslate"><span class="pre">10.10.10.2</span></code> then go to <a class="reference external" href="http://10.10.10.2:8065">http://10.10.10.2:8065</a>.</p></li>
<li><p>Create the first team and user. The first user in the system has the <code class="docutils literal notranslate"><span class="pre">system_admin</span></code> role, which gives you access to the System Console.</p></li>
<li><p>To open the System Console, click your username at the top of the navigation panel and select <strong>System Console</strong>.</p></li>
<li><p>Set the Site URL:</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>Open <strong>System Console &gt; Environment &gt; Web Server</strong>.</p></li>
<li><p>In the <strong>Site URL</strong> field, set the URL that users point their browsers at. For example, <em>https://mattermost.example.com</em>. If you are using HTTPS, make sure that you set up TLS, either on Mattermost Server or on a proxy.</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>Set up email notifications.</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>In <strong>Site Configuration &gt; Notifications</strong> make the following changes:</p>
<ul>
<li><p>Set <strong>Enable Email Notifications</strong> to <strong>true</strong></p></li>
<li><p>Set <strong>Notification Display Name</strong> to <strong>No-Reply</strong></p></li>
<li><p>Set <strong>Notification From Address</strong> to <em>{your-domain-name}</em> For example, <em>example.com</em></p></li>
</ul>
</li>
<li><p>In <strong>System Console &gt; Environment &gt; SMTP</strong> make the following changes:</p>
<ul>
<li><p>Set <strong>SMTP Server Username</strong> to <em>{SMTP-username}</em> For example, <em>admin&#64;example.com</em></p></li>
<li><p>Set <strong>SMTP Server Password</strong> to <em>{SMTP-password}</em></p></li>
<li><p>Set <strong>SMTP Server</strong> to <em>{SMTP-server}</em> For example, <em>mail.example.com</em></p></li>
<li><p>Set <strong>SMTP Server Port</strong> to <em>465</em></p></li>
<li><p>Set <strong>Connection Security</strong> to <em>TLS</em> or <em>STARTTLS</em>, depending on what the SMTP server accepts</p></li>
</ul>
</li>
<li><p>Click <strong>Test Connection</strong>.</p></li>
<li><p>When the connection is confirmed as working, select <strong>Save</strong>.</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p>Open <strong>System Console</strong> &gt; <strong>Environment</strong> &gt; <strong>File Storage</strong> to set up the file and image storage location.</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>If you store the files locally, set <strong>File Storage System</strong> to <em>Local File System</em>, and then either accept the default for the <strong>Local Storage Directory</strong> or enter a location. The location must be a directory that exists and has write permissions for the Mattermost server. It can be an absolute path or a relative path. Relative paths are relative to the <code class="docutils literal notranslate"><span class="pre">mattermost</span></code> directory.</p></li>
<li><p>If you store the files on Amazon S3, set <strong>File Storage System</strong> to <em>Amazon S3</em> and enter the appropriate values for your Amazon account.</p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Files and images that users attach to their messages are not stored in the database. Instead, they’re stored in a location that you specify. You can store the files on the local file system or in Amazon S3.</p></li>
<li><p>Make sure that the location has enough free space. The amount of storage that’s required depends on the number of users and on the number and size of files that users attach to messages.</p></li>
</ul>
</div>
<ol class="arabic simple" start="7">
<li><p>Select <strong>Save</strong> to apply the configuration.</p></li>
<li><p>Review and configure any other settings that may be applicable.</p></li>
<li><p>Restart Mattermost.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">restart</span> <span class="pre">mattermost</span></code></p>
</div></blockquote>
</div>
<div class="section" id="configuring-tls-on-mattermost-server">
<h2><a class="toc-backref" href="#install-and-configure-the-components-in-the-following-order-note-that-you-need-only-one-database-either-mysql-or-postgresql">Configuring TLS on Mattermost Server</a><a class="headerlink" href="#configuring-tls-on-mattermost-server" title="Permalink to this headline">¶</a></h2>
<p>You have two options if you want users to connect with HTTPS:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Set up TLS on Mattermost Server.</p></li>
<li><p>Install a proxy such as NGINX and set up TLS on the proxy.</p></li>
</ol>
</div></blockquote>
<p>The easiest option is to set up TLS on the Mattermost Server, but if you expect to have more than 200 users, use a proxy for better performance. A proxy server also provides standard HTTP request logs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Your Mattermost server must be accessible from the Let’s Encrypt CA in order to verify your domain name and issue the certificate. Be sure to open your firewall and configure any reverse proxies to forward traffic to ports 80 and 443. More information can be found <a class="reference external" href="https://letsencrypt.org/how-it-works/">at Let’s Encrypt</a>.</p>
</div>
<p><strong>Configure TLS on the Mattermost Server</strong>:</p>
<ol class="arabic simple">
<li><p>In <strong>System Console &gt; Environment &gt; Web Server</strong> (or <strong>System Console &gt; General &gt; Configuration</strong> in versions prior to 5.12).</p></li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Change the <strong>Listen Address</strong> setting to <code class="docutils literal notranslate"><span class="pre">:443</span></code>.</p></li>
<li><p>Change the <strong>Connection Security</strong> setting to <code class="docutils literal notranslate"><span class="pre">TLS</span></code>.</p></li>
<li><p>Change the <strong>Forward port 80 to 443</strong> setting to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p></li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Activate the <code class="docutils literal notranslate"><span class="pre">CAP_NET_BIND_SERVICE</span></code> capability to allow Mattermost to bind to low ports.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">setcap</span> <span class="pre">cap_net_bind_service=+ep</span> <span class="pre">/opt/mattermost/bin/mattermost</span></code></p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Install the security certificate. You can use <a class="reference external" href="https://letsencrypt.org/">Let’s Encrypt</a> to automatically install and setup the certificate, or you can specify your own certificate.</p></li>
</ol>
<p><strong>To use a Let’s Encrypt certificate</strong>:</p>
<p>The certificate is retrieved the first time that a client tries to connect to the Mattermost server. Certificates are retrieved for any hostname a client tries to reach the server at.</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Change the <strong>Use Let’s Encrypt</strong> setting to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p></li>
<li><p>Restart the Mattermost server for these changes to take effect.</p></li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If Let’s Encrypt is enabled, forward port 80 through a firewall, with <a class="reference external" href="https://docs.mattermost.com/administration/config-settings.html#forward-port-80-to-443">Forward80To443</a> <code class="docutils literal notranslate"><span class="pre">config.json</span></code> setting set to <code class="docutils literal notranslate"><span class="pre">true</span></code> to complete the Let’s Encrypt certification.</p>
</div>
<p><strong>To use your own certificate</strong>:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Change the <strong>Use Let’s Encrypt</strong> setting to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p>Change the <strong>TLS Certificate File</strong> setting to the location of the certificate file.</p></li>
<li><p>Change the <strong>TLS Key File</strong> setting to the location of the private key file.</p></li>
<li><p>Restart the Mattermost server for these changes to take effect.</p></li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Password-protected certificates are not supported.</p>
</div>
<p><strong>Using TLS on NGINX (as a proxy)</strong></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Do not set up TLS on Mattermost before before doing so for NGINX. It breaks the connection as the TLS prevents it from successfully communicating with the Mattermost server.</p>
</div>
<ul class="simple">
<li><p>NGINX will act as a forward proxy to encrypt the traffic between the client and Mattermost server. After installing the SSL certificate, the incoming traffic will be handled via NGINX on port 443 exposed to the internet, proxy to the Mattermost server running on port 80.</p></li>
<li><p>(Optional) Upstream encryption between NGINX to Mattermost server is allowed.</p></li>
<li><p>Follow <a class="reference external" href="https://docs.nginx.com/nginx/admin-guide/security-controls/terminating-ssl-tcp/">NGINX’s guide on setting up SSL Termination for TCP Upstream Servers</a>.</p></li>
</ul>
<p>Other helpful resources:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.nginx.com/blog/nginx-ssl/">NGINX’s SSL blog</a></p></li>
<li><p><a class="reference external" href="https://docs.nginx.com/nginx/admin-guide/security-controls/terminating-ssl-http/">NGINX’s SSLguide</a></p></li>
</ul>
</div>
<div class="section" id="installing-nginx-server">
<span id="install-nginx"></span><h2><a class="toc-backref" href="#install-and-configure-the-components-in-the-following-order-note-that-you-need-only-one-database-either-mysql-or-postgresql">Installing NGINX Server</a><a class="headerlink" href="#installing-nginx-server" title="Permalink to this headline">¶</a></h2>
<p>In a production setting, use a proxy server for greater security and performance of Mattermost.</p>
<p>The main benefits of using a proxy are as follows:</p>
<blockquote>
<div><ul class="simple">
<li><p>SSL termination</p></li>
<li><p>HTTP to HTTPS redirect</p></li>
<li><p>Port mapping <code class="docutils literal notranslate"><span class="pre">:80</span></code> to <code class="docutils literal notranslate"><span class="pre">:8065</span></code></p></li>
<li><p>Standard request logs</p></li>
</ul>
</div></blockquote>
<p><strong>To install NGINX on Ubuntu Server:</strong></p>
<ol class="arabic simple">
<li><p>Log in to the server that will host the proxy and open a terminal window.</p></li>
<li><p>Install NGINX.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">nginx</span></code></p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>After the installation is complete, verify that NGINX is running.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">http://localhost</span></code></p>
<p>If NGINX is running, you see the following output:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Welcome to nginx!<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
.
.
.
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">em</span><span class="p">&gt;</span>Thank you for using nginx.<span class="p">&lt;/</span><span class="nt">em</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can stop, start, and restart NGINX with the following commands:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo service nginx stop
sudo service nginx start
sudo service nginx restart
</pre></div>
</div>
</div>
<p><strong>What to do next</strong></p>
<ol class="arabic simple">
<li><p>Map a fully qualified domain name (FQDN) such as <code class="docutils literal notranslate"><span class="pre">mattermost.example.com</span></code> to point to the NGINX server.</p></li>
<li><p>Configure NGINX to proxy connections from the internet to the Mattermost Server.</p></li>
</ol>
</div>
<div class="section" id="configuring-nginx-as-a-proxy-for-mattermost-server">
<span id="config-proxy-nginx"></span><h2><a class="toc-backref" href="#install-and-configure-the-components-in-the-following-order-note-that-you-need-only-one-database-either-mysql-or-postgresql">Configuring NGINX as a proxy for Mattermost Server</a><a class="headerlink" href="#configuring-nginx-as-a-proxy-for-mattermost-server" title="Permalink to this headline">¶</a></h2>
<p>NGINX is configured using a file in the <code class="docutils literal notranslate"><span class="pre">/etc/nginx/sites-available</span></code> directory. You need to create the file and then enable it. When creating the file, you need the IP address of your Mattermost server and the fully qualified domain name (FQDN) of your Mattermost website.</p>
<p><strong>To configure NGINX as a proxy</strong></p>
<ol class="arabic simple">
<li><p>Log in to the server that hosts NGINX and open a terminal window.</p></li>
<li><p>Create a configuration file for Mattermost.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">touch</span> <span class="pre">/etc/nginx/sites-available/mattermost</span></code></p>
</div></blockquote>
<p>On RHEL 7 and 8: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">touch</span> <span class="pre">/etc/nginx/conf.d/mattermost</span></code></p>
<ol class="arabic simple" start="3">
<li><p>Open the file <code class="docutils literal notranslate"><span class="pre">/etc/nginx/sites-available/mattermost</span></code> as <em>root</em> user in a text editor and replace its contents, if any, with the following lines. Make sure that you use your own values for the Mattermost server IP address and FQDN for <em>server_name</em>.</p></li>
</ol>
<p>On RHEL 7 and 8, open the file <code class="docutils literal notranslate"><span class="pre">/etc/nginx/conf.d/mattermost</span></code>.</p>
<p>SSL and HTTP/2 with server push are enabled in the provided configuration example.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you’re going to use Let’s Encrypt to manage your SSL certificate stop at step 3 here and please see the <a class="reference external" href="https://docs.mattermost.com/install/config-ssl-http2-nginx.html">NGINX HTTP/2 &amp; SSL full configuration guide</a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You’ll need valid SSL certificates in order for NGINX to pin the certificates properly. Additionally, your browser must have permissions to accept the certificate as a valid CA-signed certificate.</p>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>upstream backend {
   server 10.10.10.2:8065;
   keepalive 32;
}

proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=mattermost_cache:10m max_size=3g inactive=120m use_temp_path=off;

server {
  listen 80 default_server;
  server_name   mattermost.example.com;
  return 301 https://$server_name$request_uri;
}

server {
   listen 443 ssl http2;
   server_name    mattermost.example.com;

   http2_push_preload on; # Enable HTTP/2 Server Push

   ssl on;
   ssl_certificate /etc/letsencrypt/live/{domain-name}/fullchain.pem;
   ssl_certificate_key /etc/letsencrypt/live/{domain-name}/privkey.pem;
   ssl_session_timeout 1d;

   # Enable TLS versions (TLSv1.3 is required upcoming HTTP/3 QUIC).
   ssl_protocols TLSv1.2 TLSv1.3;

   # Enable TLSv1.3&#39;s 0-RTT. Use $ssl_early_data when reverse proxying to
   # prevent replay attacks.
   #
   # @see: https://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_early_data
   ssl_early_data on;

   ssl_ciphers &#39;ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256&#39;;
   ssl_prefer_server_ciphers on;
   ssl_session_cache shared:SSL:50m;
   # HSTS (ngx_http_headers_module is required) (15768000 seconds = 6 months)
   add_header Strict-Transport-Security max-age=15768000;
   # OCSP Stapling ---
   # fetch OCSP records from URL in ssl_certificate and cache them
   ssl_stapling on;
   ssl_stapling_verify on;

   add_header X-Early-Data $tls1_3_early_data;

   location ~ /api/v[0-9]+/(users/)?websocket$ {
       proxy_set_header Upgrade $http_upgrade;
       proxy_set_header Connection &quot;upgrade&quot;;
       client_max_body_size 50M;
       proxy_set_header Host $http_host;
       proxy_set_header X-Real-IP $remote_addr;
       proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
       proxy_set_header X-Forwarded-Proto $scheme;
       proxy_set_header X-Frame-Options SAMEORIGIN;
       proxy_buffers 256 16k;
       proxy_buffer_size 16k;
       client_body_timeout 60;
       send_timeout 300;
       lingering_timeout 5;
       proxy_connect_timeout 90;
       proxy_send_timeout 300;
       proxy_read_timeout 90s;
       proxy_http_version 1.1;
       proxy_pass http://backend;
   }

   location / {
       client_max_body_size 50M;
       proxy_set_header Connection &quot;&quot;;
       proxy_set_header Host $http_host;
       proxy_set_header X-Real-IP $remote_addr;
       proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
       proxy_set_header X-Forwarded-Proto $scheme;
       proxy_set_header X-Frame-Options SAMEORIGIN;
       proxy_buffers 256 16k;
       proxy_buffer_size 16k;
       proxy_read_timeout 600s;
       proxy_cache mattermost_cache;
       proxy_cache_revalidate on;
       proxy_cache_min_uses 2;
       proxy_cache_use_stale timeout;
       proxy_cache_lock on;
       proxy_http_version 1.1;
       proxy_pass http://backend;
   }
}

# This block is useful for debugging TLS v1.3. Please feel free to remove this
# and use the `$ssl_early_data` variable exposed by NGINX directly should you
# wish to do so.
map $ssl_early_data $tls1_3_early_data {
  &quot;~.&quot; $ssl_early_data;
  default &quot;&quot;;
}
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Remove the existing default sites-enabled file.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">rm</span> <span class="pre">/etc/nginx/sites-enabled/default</span></code></p>
</div></blockquote>
<p>On RHEL 7 and 8: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">rm</span> <span class="pre">/etc/nginx/conf.d/default</span></code></p>
<ol class="arabic simple" start="5">
<li><p>Enable the mattermost configuration.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">/etc/nginx/sites-available/mattermost</span> <span class="pre">/etc/nginx/sites-enabled/mattermost</span></code></p>
</div></blockquote>
<p>On RHEL 7 and 8: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">/etc/nginx/conf.d/mattermost</span> <span class="pre">/etc/nginx/conf.d/default.conf</span></code></p>
<ol class="arabic simple" start="6">
<li><p>Restart NGINX.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">restart</span> <span class="pre">nginx</span></code></p>
</div></blockquote>
<ol class="arabic simple" start="7">
<li><p>Verify that you can see Mattermost through the proxy.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">https://localhost</span></code></p>
<p>If everything is working, you will see the HTML for the Mattermost signup page.</p>
</div></blockquote>
<ol class="arabic simple" start="8">
<li><p>Restrict access to port 8065.</p></li>
</ol>
<p>By default, the Mattermost server accepts connections on port 8065 from every machine on the network. Use your firewall to deny connections on port 8065 to all machines except the machine that hosts NGINX and the machine that you use to administer Mattermost server. If you’re installing on Amazon Web Services, you can use Security Groups to restrict access.</p>
<p>Now that NGINX is installed and running, you can configure it to use SSL, which allows you to use HTTPS connections and the HTTP/2 protocol.</p>
<div class="section" id="nginx-configuration-faq">
<h3><a class="toc-backref" href="#install-and-configure-the-components-in-the-following-order-note-that-you-need-only-one-database-either-mysql-or-postgresql">NGINX Configuration FAQ</a><a class="headerlink" href="#nginx-configuration-faq" title="Permalink to this headline">¶</a></h3>
<p><strong>Why are Websocket connections returning a 403 error?</strong></p>
<p>This is likely due to a failing cross-origin check. A check is applied for WebSocket code to see if the <code class="docutils literal notranslate"><span class="pre">Origin</span></code> header is the same as the host header. If it’s not, a 403 error is returned. Open the file <code class="docutils literal notranslate"><span class="pre">/etc/nginx/sites-available/mattermost</span></code> as root in a text editor and make sure that the host header being set in the proxy is dynamic:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>location ~ /api/v[0-9]+/(users/)?websocket$ {
  proxy_pass            http://backend;
  (...)
<span class="hll">  proxy_set_header      Host $host;
</span>  proxy_set_header      X-Forwarded-For $remote_addr;
}
</pre></div>
</div>
<p>Then in <code class="docutils literal notranslate"><span class="pre">config.json</span></code> set the <code class="docutils literal notranslate"><span class="pre">AllowCorsFrom</span></code> setting to match the domain being used by clients. You may need to add variations of the host name that clients may send. Your NGINX log will be helpful in diagnosing the problem.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&quot;EnableUserAccessTokens&quot;: false,
<span class="hll">&quot;AllowCorsFrom&quot;: &quot;domain.com domain.com:443 im.domain.com&quot;,
</span>&quot;SessionLengthWebInDays&quot;: 30,
</pre></div>
</div>
<p>For other troubleshooting tips for WebSocket errors, see <a class="reference external" href="https://docs.mattermost.com/install/troubleshooting.html#please-check-connection-mattermost-unreachable-if-issue-persists-ask-administrator-to-check-websocket-port">potential solutions here</a>.</p>
<p><strong>How do I setup an NGINX proxy with the Mattermost Docker installation?</strong></p>
<ol class="arabic simple">
<li><p>Find the name of the Mattermost network and connect it to the NGINX proxy.</p></li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker network ls
# Grep the name of your Mattermost network like &quot;mymattermost_default&quot;.
docker network connect mymattermost_default nginx-proxy
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Restart the Mattermost Docker containers.</p></li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker-compose stop app
docker-compose start app
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You don’t need to run the ‘web’ container, since NGINX proxy accepts incoming requests.</p>
</div>
<ol class="arabic simple" start="3">
<li><p>Update your <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file to include a new environment variable <code class="docutils literal notranslate"><span class="pre">VIRTUAL_HOST</span></code> and an <code class="docutils literal notranslate"><span class="pre">expose</span></code> directive.</p></li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>environment:
  # set same as db credentials and dbname
  - MM_USERNAME=mmuser
  - MM_PASSWORD=mmuser-password
  - MM_DBNAME=mattermost
  - VIRTUAL_HOST=mymattermost.tld
expose:
  - &quot;80&quot;
  - &quot;443&quot;
</pre></div>
</div>
<p><strong>Why does NGINX fail when installing Gitlab CE with Mattermost on Azure?</strong></p>
<p>You may need to update the callback URLs for the Application entry of Mattermost inside your GitLab instance.</p>
<ol class="arabic simple">
<li><p>Log in to your GitLab instance as the admin.</p></li>
<li><p>Go to <strong>Admin &gt; Applications</strong>.</p></li>
<li><p>Click <strong>Edit</strong> on GitLab-Mattermost.</p></li>
<li><p>Update the Callback URLs to your new domain/URL.</p></li>
<li><p>Save the changes.</p></li>
<li><p>Update the external URL for GitLab and Mattermost in the <code class="docutils literal notranslate"><span class="pre">/etc/gitlab/gitlab.rb</span></code> configuration file.</p></li>
</ol>
</div>
</div>
<div class="section" id="configuring-nginx-with-ssl-and-http-2">
<span id="config-ssl-http2-nginx"></span><h2><a class="toc-backref" href="#install-and-configure-the-components-in-the-following-order-note-that-you-need-only-one-database-either-mysql-or-postgresql">Configuring NGINX with SSL and HTTP/2</a><a class="headerlink" href="#configuring-nginx-with-ssl-and-http-2" title="Permalink to this headline">¶</a></h2>
<p>NGINX is configured using a file in the <code class="docutils literal notranslate"><span class="pre">/etc/nginx/sites-available</span></code> directory. You need to create the file and then enable it. When creating the file, you need the IP address of your Mattermost server and the fully qualified domain name (FQDN) of your Mattermost website.</p>
<p>Using SSL gives greater security by ensuring that communications between Mattermost clients and the Mattermost server are encrypted. It also allows you to configure NGINX to use the HTTP/2 protocol.</p>
<p>Although you can configure HTTP/2 without SSL, both Firefox and Chrome browsers support HTTP/2 on secure connections only.</p>
<p>You can use any certificate that you want, but these instructions show you how to download and install certificates from <a class="reference external" href="https://letsencrypt.org/">Let’s Encrypt</a>, a free certificate authority.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If Let’s Encrypt is enabled, forward port 80 through a firewall, with <a class="reference external" href="https://docs.mattermost.com/administration/config-settings.html#forward-port-80-to-443">Forward80To443</a> <code class="docutils literal notranslate"><span class="pre">config.json</span></code> setting set to <code class="docutils literal notranslate"><span class="pre">true</span></code> to complete the Let’s Encrypt certification.</p>
</div>
<p><strong>To configure NGINX as a proxy with SSL and HTTP/2</strong></p>
<p>If you’re looking for additional Let’s Encrypt/Certbot assistance you can access their documentation <a class="reference external" href="https://certbot.eff.org">here</a> .</p>
<ol class="arabic simple">
<li><p>Log in to the server that hosts NGINX and open a terminal window.</p></li>
<li><p>Open the your Mattermost <code class="docutils literal notranslate"><span class="pre">nginx.conf</span></code> file as <em>root</em> in a text editor and update the <code class="docutils literal notranslate"><span class="pre">{ip}</span></code> address in the <code class="docutils literal notranslate"><span class="pre">upstream</span> <span class="pre">backend</span></code> to point towards Mattermost (ex: <code class="docutils literal notranslate"><span class="pre">127.0.0.1:8065</span></code>, and the <code class="docutils literal notranslate"><span class="pre">server_name</span></code> to be your domain for Mattermost.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>On Ubuntu this file is located at <code class="docutils literal notranslate"><span class="pre">/etc/nginx/sites-available/</span></code>. If you don’t have this file run <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">touch</span> <span class="pre">/etc/nginx/sites-available/mattermost</span></code>.
On CentOS/RHEL this file is located at <code class="docutils literal notranslate"><span class="pre">/etc/nginx/conf.d/</span></code>. If you don’t have this file run <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">touch</span> <span class="pre">/etc/nginx/conf.d/mattermost</span></code>.</p>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>upstream backend {
    server {ip}:8065;
    keepalive 32;
    }

proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=mattermost_cache:10m max_size=3g inactive=120m use_temp_path=off;

server {
    listen 80 default_server;
    server_name mattermost.example.com;

    location ~ /api/v[0-9]+/(users/)?websocket$ {
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection &quot;upgrade&quot;;
        client_max_body_size 50M;
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Frame-Options SAMEORIGIN;
        proxy_buffers 256 16k;
        proxy_buffer_size 16k;
        client_body_timeout 60;
        send_timeout 300;
        lingering_timeout 5;
        proxy_connect_timeout 90;
        proxy_send_timeout 300;
        proxy_read_timeout 90s;
        proxy_pass http://backend;
    }

    location / {
        client_max_body_size 50M;
        proxy_set_header Connection &quot;&quot;;
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Frame-Options SAMEORIGIN;
        proxy_buffers 256 16k;
        proxy_buffer_size 16k;
        proxy_read_timeout 600s;
        proxy_cache mattermost_cache;
        proxy_cache_revalidate on;
        proxy_cache_min_uses 2;
        proxy_cache_use_stale timeout;
        proxy_cache_lock on;
        proxy_http_version 1.1;
        proxy_pass http://backend;
    }
}
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Remove the existing default sites-enabled file.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">rm</span> <span class="pre">/etc/nginx/sites-enabled/default</span></code></p>
<blockquote>
<div><p>On RHEL 7+: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">rm</span> <span class="pre">/etc/nginx/conf.d/default</span></code></p>
</div></blockquote>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>Enable the Mattermost configuration.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">/etc/nginx/sites-available/mattermost</span> <span class="pre">/etc/nginx/sites-enabled/mattermost</span></code></p>
<blockquote>
<div><p>On RHEL 7+: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">/etc/nginx/conf.d/mattermost</span> <span class="pre">/etc/nginx/conf.d/default.conf</span></code></p>
</div></blockquote>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>Run <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">nginx</span> <span class="pre">-t</span></code> to ensure your configuration is done properly. If you get an error, look into the NGINX config and make the needed changes to the file under <code class="docutils literal notranslate"><span class="pre">/etc/nginx/sites-available/mattermost</span></code>.</p></li>
<li><p>Restart NGINX.</p></li>
</ol>
<blockquote>
<div><p>On Ubuntu 18.04+, RHEL 7+:</p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">nginx</span></code></p>
</div></blockquote>
<ol class="arabic simple" start="7">
<li><p>Verify that you can see Mattermost through the proxy.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">http://localhost</span></code></p>
<p>If everything is working, you will see the HTML for the Mattermost signup page. You will see invalid certificate when accessing through the IP or localhost. Use the full FQDN domain to verify if the SSL certificate has pinned properly and is valid.</p>
</div></blockquote>
<ol class="arabic simple" start="8">
<li><p>Install and update Snap.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">snap</span> <span class="pre">install</span> <span class="pre">core;</span> <span class="pre">sudo</span> <span class="pre">snap</span> <span class="pre">refresh</span> <span class="pre">core</span></code></p>
</div></blockquote>
<ol class="arabic simple" start="9">
<li><p>Install the Certbot package.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">snap</span> <span class="pre">install</span> <span class="pre">--classic</span> <span class="pre">certbot</span></code></p>
</div></blockquote>
<ol class="arabic simple" start="10">
<li><p>Add a symbolic link to ensure Certbot can run.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">/snap/bin/certbot</span> <span class="pre">/usr/bin/certbot</span></code></p>
</div></blockquote>
<ol class="arabic simple" start="11">
<li><p>Run the Let’s Encrypt installer dry-run to ensure your DNS is configured properly.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">certbot</span> <span class="pre">certonly</span> <span class="pre">--dry-run</span></code></p>
<p>This will prompt you to enter your email, accept the TOS, share your email, and select the domain you’re activating certbot for. This will validate that your DNS points to this server properly and you are able to successfully generate a certificate. If this finishes successfully, proceed to step 12.</p>
</div></blockquote>
<ol class="arabic simple" start="12">
<li><p>Run the Let’s Encrypt installer.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">certbot</span></code></p>
<p>This will run certbot and will automatically edit your NGINX config file for the site(s) selected.</p>
</div></blockquote>
<ol class="arabic simple" start="13">
<li><p>Ensure your SSL is configured properly by running:</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">https://{your</span> <span class="pre">domain</span> <span class="pre">here}</span></code></p>
</div></blockquote>
<ol class="arabic simple" start="14">
<li><p>Finally, we suggest editing your config file again to increase your SSL security settings above the default Let’s Encrypt. This is the same file from Step 2 above. Edit it to look like the below:</p></li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>upstream backend {
    server {ip}:8065;
   keepalive 32;
    }

proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=mattermost_cache:10m max_size=3g inactive=120m use_temp_path=off;

server {
    server_name mattermost.example.com;

    location ~ /api/v[0-9]+/(users/)?websocket$ {
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection &quot;upgrade&quot;;
        client_max_body_size 50M;
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Frame-Options SAMEORIGIN;
        proxy_buffers 256 16k;
        proxy_buffer_size 16k;
        client_body_timeout 60;
        send_timeout 300;
        lingering_timeout 5;
        proxy_connect_timeout 90;
        proxy_send_timeout 300;
        proxy_read_timeout 90s;
        proxy_http_version 1.1;
        proxy_pass http://backend;
    }

    location / {
        client_max_body_size 50M;
        proxy_set_header Connection &quot;&quot;;
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Frame-Options SAMEORIGIN;
        proxy_buffers 256 16k;
        proxy_buffer_size 16k;
        proxy_read_timeout 600s;
        proxy_cache mattermost_cache;
        proxy_cache_revalidate on;
        proxy_cache_min_uses 2;
        proxy_cache_use_stale timeout;
        proxy_cache_lock on;
        proxy_http_version 1.1;
        proxy_pass http://backend;
    }

    listen 443 ssl http2; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/mattermost.example.com/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/mattermost.example.com/privkey.pem; # managed by Certbot
    # include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot

    ssl_session_timeout 1d;

    # Enable TLS versions (TLSv1.3 is required upcoming HTTP/3 QUIC).
    ssl_protocols TLSv1.2 TLSv1.3;

    # Enable TLSv1.3&#39;s 0-RTT. Use $ssl_early_data when reverse proxying to
    # prevent replay attacks.
    #
    # @see: https://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_early_data
    ssl_early_data on;

    ssl_ciphers &#39;ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SH&gt;
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:50m;
    # HSTS (ngx_http_headers_module is required) (15768000 seconds = 6 months)
    add_header Strict-Transport-Security max-age=15768000;
    # OCSP Stapling ---
    # fetch OCSP records from URL in ssl_certificate and cache them
    ssl_stapling on;
    ssl_stapling_verify on;
}


server {
    if ($host = mattermost.example.com) {
        return 301 https://$host$request_uri;
    } # managed by Certbot


    listen 80 default_server;
    server_name mattermost.example.com;
    return 404; # managed by Certbot

}
</pre></div>
</div>
<ol class="arabic simple" start="15">
<li><p>Check that your SSL certificate is set up correctly.</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>Test the SSL certificate by visiting a site such as <a class="reference external" href="https://www.ssllabs.com/ssltest/index.html">https://www.ssllabs.com/ssltest/index.html</a>.</p></li>
<li><p>If there’s an error about the missing chain or certificate path, there is likely an intermediate certificate missing that needs to be included.</p></li>
</ul>
</div></blockquote>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#install-and-configure-the-components-in-the-following-order-note-that-you-need-only-one-database-either-mysql-or-postgresql">NGINX Configuration FAQ</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p><strong>Why are Websocket connections returning a 403 error?</strong></p>
<p>This is likely due to a failing cross-origin check. A check is applied for WebSocket code to see if the <code class="docutils literal notranslate"><span class="pre">Origin</span></code> header is the same as the host header. If it’s not, a 403 error is returned. Open the file <code class="docutils literal notranslate"><span class="pre">/etc/nginx/sites-available/mattermost</span></code> as <em>root</em> in a text editor and make sure that the host header being set in the proxy is dynamic:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>location ~ /api/v[0-9]+/(users/)?websocket$ {
  proxy_pass            http://backend;
  (...)
<span class="hll">  proxy_set_header      Host $host;
</span>  proxy_set_header      X-Forwarded-For $remote_addr;
}
</pre></div>
</div>
<p>Then in <code class="docutils literal notranslate"><span class="pre">config.json</span></code> set the <code class="docutils literal notranslate"><span class="pre">AllowCorsFrom</span></code> setting to match the domain being used by clients. You may need to add variations of the host name that clients may send. Your NGINX log will be helpful in diagnosing the problem.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&quot;EnableUserAccessTokens&quot;: false,
<span class="hll">&quot;AllowCorsFrom&quot;: &quot;domain.com domain.com:443 im.domain.com&quot;,
</span>&quot;SessionLengthWebInDays&quot;: 30,
</pre></div>
</div>
<p>For other troubleshooting tips for WebSocket errors, see <a class="reference external" href="https://docs.mattermost.com/install/troubleshooting.html#please-check-connection-mattermost-unreachable-if-issue-persists-ask-administrator-to-check-websocket-port">potential solutions here</a>.</p>
<p><strong>How do I setup an NGINX proxy with the Mattermost Docker installation?</strong></p>
<ol class="arabic simple">
<li><p>Find the name of the Mattermost network and connect it to the NGINX proxy.</p></li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker network ls
# Grep the name of your Mattermost network like &quot;mymattermost_default&quot;.
docker network connect mymattermost_default nginx-proxy
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Restart the Mattermost Docker containers.</p></li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker-compose stop app
docker-compose start app
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You don’t need to run the ‘web’ container, since NGINX proxy accepts incoming requests.</p>
</div>
<ol class="arabic simple" start="3">
<li><p>Update your <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file to include a new environment variable <code class="docutils literal notranslate"><span class="pre">VIRTUAL_HOST</span></code> and an <code class="docutils literal notranslate"><span class="pre">expose</span></code> directive.</p></li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>environment:
  # set same as db credentials and dbname
  - MM_USERNAME=mmuser
  - MM_PASSWORD=mmuser-password
  - MM_DBNAME=mattermost
  - VIRTUAL_HOST=mymattermost.tld
expose:
  - &quot;80&quot;
  - &quot;443&quot;
</pre></div>
</div>
<p><strong>Why does NGINX fail when installing Gitlab CE with Mattermost on Azure?</strong></p>
<p>You may need to update the Callback URLs for the Application entry of Mattermost inside your GitLab instance.</p>
<ol class="arabic simple">
<li><p>Log in to your GitLab instance as the admin.</p></li>
<li><p>Go to <strong>Admin &gt; Applications</strong>.</p></li>
<li><p>Select <strong>Edit</strong> on GitLab-Mattermost.</p></li>
<li><p>Update the callback URLs to your new domain/URL.</p></li>
<li><p>Save the changes.</p></li>
<li><p>Update the external URL for GitLab and Mattermost in the <code class="docutils literal notranslate"><span class="pre">/etc/gitlab/gitlab.rb</span></code> configuration file.</p></li>
</ol>
<p><strong>Why does Certbot fail the http-01 challenge?</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Requesting a certificate for yourdomain.com
Performing the following challenges:
http-01 challenge for yourdomain.com
Waiting for verification...
Challenge failed for domain yourdomain.com
http-01 challenge for yourdomain.com
Cleaning up challenges
Some challenges have failed.
</pre></div>
</div>
<p>If you see the above errors this is typically because certbot was not able to access port 80. This can be due to a firewall or other DNS configuration. Ensure that your A/AAAA records are pointing to this server and your <code class="docutils literal notranslate"><span class="pre">server_name</span></code> within the NGINX config does not have a redirect.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you’re using Cloudflare you’ll need to disable <code class="docutils literal notranslate"><span class="pre">force</span> <span class="pre">traffic</span> <span class="pre">to</span> <span class="pre">https</span></code>.</p>
</div>
<p><strong>Certbot rate limiting</strong></p>
<p>If you’re running certbot as stand-alone you’ll see this error:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Error: Could not issue a Let&#39;s Encrypt SSL/TLS certificate for example.com.
One of the Let&#39;s Encrypt rate limits has been exceeded for example.com.
See the related Knowledge Base article for details.
Details
Invalid response from https://acme-v02.api.letsencrypt.org/acme/new-order.
Details:
Type: urn:ietf:params:acme:error:rateLimited
Status: 429
Detail: Error creating new order :: too many failed authorizations recently: see https://letsencrypt.org/docs/rate-limits/
</pre></div>
</div>
<p>If you’re running Let’s Encrypt within Mattermost you’ll see this error:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{&quot;level&quot;:&quot;error&quot;,&quot;ts&quot;:1609092001.752515,&quot;caller&quot;:&quot;http/server.go:3088&quot;,&quot;msg&quot;:&quot;http: TLS handshake error from ip:port: 429 urn:ietf:params:acme:error:rateLimited: Error creating new order :: too many failed authorizations recently: see https://letsencrypt.org/docs/rate-limits/&quot;,&quot;source&quot;:&quot;httpserver&quot;}
</pre></div>
</div>
<p>This means that you’ve attempted to generate a cert too many times. You can find more information <a class="reference external" href="https://letsencrypt.org/docs/rate-limits">here</a>.</p>
</div>
</div>
</div>


           </div>
           
          </article>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="mattermost-omnibus.html" class="btn btn-neutral float-right" title="Installing Mattermost Omnibus" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="install-ubuntu-2004.html" class="btn btn-neutral float-left" title="Installing Mattermost on Ubuntu 20.04 LTS" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2015-2021 Mattermost.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  
 




<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-cog">&nbsp;&nbsp;Options</span>&nbsp;
        <span class="fa fa-angle-up"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Contribute</dt>
            <dd>
                <a href="https://github.com/mattermost/docs/issues">Report a Problem</a>
            </dd>
            
            <dd>
                <a href="https://github.com/mattermost/docs/blob/master/source/install/install-ubuntu-1804.rst"> Edit on GitHub</a>
            </dd>
            
        </dl>
    </div>
</div>


  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/myscript.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

	<script type="text/javascript">
		jQuery(function () {
			SphinxRtdTheme.Navigation.enable(true);
		});
	</script> 

<header>
	<div class="header__container">
		<div class="search__icon">
			<i class="fa fa-search"></i>
		</div>
		<a href="https://docs.mattermost.com/" class="header__logo">
			<img width="176" src="https://about.mattermost.com/wp-content/uploads/2017/08/Mattermost-Logo-Blue.svg">
		</a>
		<div class="links__icon">
			<i class="fa fa-bars"></i>
		</div>
		<ul class="header__links">
			<li><a href="https://developers.mattermost.com/">Developers</a></li>
			<li><a href="https://mattermost.com/features/">Product</a></li>
			<li><a href="https://mattermost.com/pricing/">Pricing</a></li>
			<li><a href="https://mattermost.com/blog/">Blog</a></li>
			<li><a href="https://mattermost.com/download/">Download</a></li>
			<li><a href="https://mattermost.com/trial/">Trial</a></li>
		</ul>
		<div class="header__searchbar">
			<form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
                <input type="text" name="q" placeholder="Search by keyword" autofocus />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
            </form>
		</div>
	</div>
</header>

</body>
</html>